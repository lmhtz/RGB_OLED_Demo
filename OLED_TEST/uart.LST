C51 COMPILER V9.52.0.0   UART                                                              02/11/2015 17:34:04 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN uart.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE uart.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "STC12C5A60S2.H"
   2          #include <string.h>
   3          #include "uart.h"
   4          #include "myfun.h"
   5          
   6          /**************************************************************************
   7           - 功能描述：51单片机的串口初始化
   8           - 隶属模块：STC51串口操作
   9           - 函数属性：外部，使用户使用
  10           - 参数说明：无
  11           - 返回说明：无
  12           **************************************************************************/
  13          
  14          void UART_Init()     
  15          {
  16   1       PCON|=0x80; //PCON的最高位SMOD=1时波特率加倍 
  17   1       TMOD|=0x20;  //时器1为方式2 初值自动装入 产生波特率
  18   1       TH1 = TL1 =  256-(FOSC*2/12/32/BAUD);
  19   1       SCON|=0x50;   //串口设置为方式1,REN=1,允许接收
  20   1       TR1=1;      //启动定时器1
  21   1       //ES=1;       //使能串口接收中断，
  22   1       //EA=1;       //打开所有中断
  23   1      }
  24          
  25          /**************************************************************************
  26           - 功能描述：51单片机的串口中断处理函数
  27           - 隶属模块：STC51串口操作
  28           - 函数属性：外部，使用户使用(在此中断函数中常用来处理从串口收到的数据)
  29           - 参数说明：无
  30           - 返回说明：无
  31           **************************************************************************/
  32          
  33          void sio_int() interrupt 4  //串口中断函数
  34          {
  35   1       ES=0;
  36   1        //串口中断处理
  37   1      
  38   1       ES=1;
  39   1      }
  40          
  41          /**************************************************************************
  42           - 功能描述：51单片机的串口发送字节的函数
  43           - 隶属模块：STC51串口操作
  44           - 函数属性：外部，使用户使用
  45           - 参数说明：mydata:要发送的一个字节
  46           - 返回说明：无
  47           - 注：发送一个字节，是串口发送的基础操作
  48           **************************************************************************/
  49          
  50          void UART_Send_Byte(unsigned char mydata) 
  51          {
  52   1       TI=0;
  53   1       SBUF=mydata;
  54   1       while(!TI);
  55   1       TI=0;
C51 COMPILER V9.52.0.0   UART                                                              02/11/2015 17:34:04 PAGE 2   

  56   1      }
  57          
  58          /**************************************************************************
  59           - 功能描述：51单片机的串口发送0d 0a ，即回车换行
  60           - 隶属模块：STC51串口操作
  61           - 函数属性：外部，使用户使用
  62           - 参数说明：无
  63           - 返回说明：无
  64           - 注：此函数就是发送0d 0a这两个字节，在“超级终端”上会有回车换行的效果
  65           **************************************************************************/
  66          
  67          void UART_Send_Enter()
  68          {
  69   1       UART_Send_Byte(0x0d);
  70   1       UART_Send_Byte(0x0a);
  71   1      }
  72          
  73          /**************************************************************************
  74           - 功能描述：51单片机的串口发送字符串
  75           - 隶属模块：STC51串口操作
  76           - 函数属性：外部，使用户使用
  77           - 参数说明：s:指向字符串的指针
  78           - 返回说明：无
  79           - 注：如果在字符串中有'\n'，则会发送一个回车换行
  80           **************************************************************************/
  81          
  82          void UART_Send_Str(char *s)
  83          {
  84   1       int len=strlen(s)-1;
  85   1       int i;
  86   1       for(i=0;i<len;i++)
  87   1       UART_Send_Byte(s[i]);
  88   1       if(s[i]=='\n') 
  89   1       {
  90   2        UART_Send_Enter();
  91   2       }
  92   1       else
  93   1       {
  94   2        UART_Send_Byte(s[i]);
  95   2       }
  96   1      }
  97          
  98          /**************************************************************************
  99           - 功能描述：51单片机的串口发送数值
 100           - 隶属模块：STC51串口操作
 101           - 函数属性：外部，使用户使用
 102           - 参数说明：dat:要发送的数值
 103           - 返回说明：无
 104           - 注：函数中会将数值转为相应的字符串，发送出去。比如 4567 转为 "4567" 
 105           **************************************************************************/
 106          
 107          void UART_Put_Num(unsigned long dat)
 108          {
 109   1       char temp[20];
 110   1       u32tostr(dat,temp);
 111   1       UART_Send_Str(temp);
 112   1      }
 113          
 114          /**************************************************************************
 115           - 功能描述：51单片机的串口发送调试信息
 116           - 隶属模块：STC51串口操作
 117           - 函数属性：外部，使用户使用
C51 COMPILER V9.52.0.0   UART                                                              02/11/2015 17:34:04 PAGE 3   

 118           - 参数说明：inf:指向提示信息字符串的指针
 119                       dat:一个数值，前面的提示信息就是在说明这个数值的意义
 120           - 返回说明：无
 121           **************************************************************************/
 122          
 123          void UART_Put_Inf(char *inf,unsigned long dat)
 124          {
 125   1       UART_Send_Str(inf);
 126   1       UART_Put_Num(dat);
 127   1       UART_Send_Str("\n");  
 128   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    206    ----
   CONSTANT SIZE    =      2    ----
   XDATA SIZE       =   ----      29
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
